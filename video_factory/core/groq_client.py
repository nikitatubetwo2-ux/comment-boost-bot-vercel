"""
–ö–ª–∏–µ–Ω—Ç Groq API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞
"""

from typing import Optional, List, Dict, Any
from dataclasses import dataclass
import json
from groq import Groq


@dataclass
class AnalysisResult:
    """–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞"""
    triggers: Dict[str, List[str]]
    style: Dict[str, str]
    recommendations: List[str]


class GroqClient:
    """–ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Groq API"""
    
    def __init__(self, api_key: str, model: str = "llama-3.3-70b-versatile"):
        self.client = Groq(api_key=api_key)
        self.model = model
    
    def _chat(self, messages: List[Dict], temperature: float = 0.7, max_tokens: int = 4096) -> str:
        """–ë–∞–∑–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —á–∞—Ç–∞"""
        response = self.client.chat.completions.create(
            model=self.model,
            messages=messages,
            temperature=temperature,
            max_tokens=max_tokens
        )
        return response.choices[0].message.content
    
    def chat(self, prompt: str, system: str = "–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç.", temperature: float = 0.7) -> str:
        """–ü—Ä–æ—Å—Ç–æ–π —á–∞—Ç —Å –æ–¥–Ω–∏–º –ø—Ä–æ–º–ø—Ç–æ–º"""
        return self._chat([
            {"role": "system", "content": system},
            {"role": "user", "content": prompt}
        ], temperature=temperature)
    
    def analyze_titles(self, titles: List[str]) -> Dict[str, Any]:
        """–ê–Ω–∞–ª–∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤–∏–¥–µ–æ ‚Äî –≤—ã—è–≤–ª–µ–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤"""
        prompt = f"""–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ YouTube –≤–∏–¥–µ–æ –∏ –≤—ã—è–≤–∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã/—Ç—Ä–∏–≥–≥–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–≤–ª–µ–∫–∞—é—Ç –≤–Ω–∏–º–∞–Ω–∏–µ:

–ó–ê–ì–û–õ–û–í–ö–ò:
{chr(10).join(f'- {t}' for t in titles[:30])}

–û—Ç–≤–µ—Ç—å –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ:
{{
    "triggers": {{
        "numbers": ["–ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —á–∏—Å–µ–ª"],
        "emotions": ["—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞"],
        "questions": ["–≤–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏"],
        "intrigue": ["–∏–Ω—Ç—Ä–∏–≥—É—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã"],
        "urgency": ["—ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ä–æ—á–Ω–æ—Å—Ç–∏"]
    }},
    "patterns": ["–æ–±—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤"],
    "effective_words": ["—Å–∞–º—ã–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Å–ª–æ–≤–∞"],
    "title_structure": "–æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–∏—á–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∑–∞–≥–æ–ª–æ–≤–∫–∞"
}}"""

        response = self._chat([
            {"role": "system", "content": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ YouTube SEO –∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤. –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–º JSON."},
            {"role": "user", "content": prompt}
        ])
        
        try:
            # –ò–∑–≤–ª–µ–∫–∞–µ–º JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞
            json_match = response[response.find('{'):response.rfind('}')+1]
            return json.loads(json_match)
        except:
            return {"raw_analysis": response}
    
    def analyze_style(self, descriptions: List[str], titles: List[str]) -> Dict[str, Any]:
        """–ê–Ω–∞–ª–∏–∑ —Å—Ç–∏–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞"""
        prompt = f"""–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å—Ç–∏–ª—å YouTube –∫–∞–Ω–∞–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –æ–ø–∏—Å–∞–Ω–∏–π:

–ó–ê–ì–û–õ–û–í–ö–ò:
{chr(10).join(f'- {t}' for t in titles[:20])}

–û–ü–ò–°–ê–ù–ò–Ø (–ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤ –∫–∞–∂–¥–æ–≥–æ):
{chr(10).join(f'---{chr(10)}{d[:500]}' for d in descriptions[:10])}

–û–ø—Ä–µ–¥–µ–ª–∏:
1. –°—Ç–∏–ª—å –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è (–¥–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π, —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π, –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π)
2. –¢–æ–Ω (—Å–µ—Ä—å—ë–∑–Ω—ã–π, –ª—ë–≥–∫–∏–π, –¥—Ä–∞–º–∞—Ç–∏—á–Ω—ã–π)
3. –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è
4. –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ–¥–∞—á–∏
5. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –≥–æ–ª–æ—Å –¥–ª—è –æ–∑–≤—É—á–∫–∏

–û—Ç–≤–µ—Ç—å –≤ JSON:
{{
    "narrative_style": "—Å—Ç–∏–ª—å –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è",
    "tone": "—Ç–æ–Ω",
    "target_audience": "—Ü–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è",
    "unique_features": ["–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏"],
    "recommended_voice": {{
        "gender": "–º—É–∂—Å–∫–æ–π/–∂–µ–Ω—Å–∫–∏–π",
        "type": "—Ç–∏–ø –≥–æ–ª–æ—Å–∞",
        "pace": "—Ç–µ–º–ø —Ä–µ—á–∏",
        "emotion": "—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å"
    }},
    "content_structure": "–∫–∞–∫ –æ–±—ã—á–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω –∫–æ–Ω—Ç–µ–Ω—Ç"
}}"""

        response = self._chat([
            {"role": "system", "content": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç-–∞–Ω–∞–ª–∏–∑—É YouTube. –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–º JSON."},
            {"role": "user", "content": prompt}
        ])
        
        try:
            json_match = response[response.find('{'):response.rfind('}')+1]
            return json.loads(json_match)
        except:
            return {"raw_analysis": response}
    
    def generate_subniche(self, main_topic: str, competitor_info: str) -> Dict[str, Any]:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –î–ï–†–ó–ö–ò–• –ø–æ–¥–Ω–∏—à —Å –≤—ã—Å–æ–∫–∏–º –≤–∏—Ä—É—Å–Ω—ã–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–º
        """
        prompt = f"""–ù–∞–π–¥–∏ 5 –î–ï–†–ó–ö–ò–•, –ü–†–û–í–û–ö–ê–¶–ò–û–ù–ù–´–• –ø–æ–¥–Ω–∏—à –¥–ª—è YouTube –∫–∞–Ω–∞–ª–∞.

–û–°–ù–û–í–ù–ê–Ø –¢–ï–ú–ê: {main_topic}
–ö–û–ù–ö–£–†–ï–ù–¢: {competitor_info}

=== –ö–†–ò–¢–ï–†–ò–ò –ò–î–ï–ê–õ–¨–ù–û–ô –ü–û–î–ù–ò–®–ò ===

üî• –î–ï–†–ó–û–°–¢–¨ –ò –ü–†–û–í–û–ö–ê–¶–ò–Ø (–≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–∞–≤–∏–ª YouTube):
- –¢–µ–º—ã –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–∑—ã–≤–∞—é—Ç –°–ò–õ–¨–ù–´–ï —ç–º–æ—Ü–∏–∏
- –ö–æ–Ω—Ç—Ä–æ–≤–µ—Ä—Å–∏–æ–Ω–Ω—ã–µ –Ω–æ –ù–ï –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —Ç–µ–º—ã
- "–ó–∞–ø—Ä–µ—Ç–Ω—ã–µ" –∏—Å—Ç–æ—Ä–∏–∏ –∫–æ—Ç–æ—Ä—ã–µ –º–∞–ª–æ –∫—Ç–æ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç
- –®–æ–∫–∏—Ä—É—é—â–∏–µ —Ñ–∞–∫—Ç—ã –∏ —Ä–∞–∑–æ–±–ª–∞—á–µ–Ω–∏—è
- –¢—ë–º–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π/–ª—é–¥–µ–π

üíÄ –ü–†–ò–ú–ï–†–´ –î–ï–†–ó–ö–ò–• –£–ì–õ–û–í:
- "–°–µ–∫—Ä–µ—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫–æ—Ç–æ—Ä—ã–µ —Å–∫—Ä—ã–≤–∞–ª–∏ 50 –ª–µ—Ç"
- "–ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è –∫–æ—Ç–æ—Ä—ã–µ —Å–æ—à–ª–∏ —Å —Ä—É–∫"
- "–¢—ë–º–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ [–∏–∑–≤–µ—Å—Ç–Ω–æ–π –ª–∏—á–Ω–æ—Å—Ç–∏]"
- "–ß—Ç–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ –≤ [—Å–æ–±—ã—Ç–∏–µ]"
- "–ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã [—Å—Ç—Ä–∞–Ω—ã/–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏]"
- "–ü—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏ –∏—Å—Ç–æ—Ä–∏—é"
- "–ñ–µ—Å—Ç–æ–∫–∏–µ –º–µ—Ç–æ–¥—ã [–∞—Ä–º–∏–∏/—Å–ø–µ—Ü—Å–ª—É–∂–±]"

‚ö†Ô∏è –ì–†–ê–ù–ò–¶–´ (–Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å):
- –ù–∏–∫–∞–∫–æ–≥–æ —ç–∫—Å—Ç—Ä–µ–º–∏–∑–º–∞ –∏ –ø—Ä–∏–∑—ã–≤–æ–≤ –∫ –Ω–∞—Å–∏–ª–∏—é
- –ù–∏–∫–∞–∫–æ–π –ø—Ä–æ–ø–∞–≥–∞–Ω–¥—ã
- –§–∞–∫—Ç—ã, –∞ –Ω–µ –≤—ã–¥—É–º–∫–∏
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω

=== –ó–ê–î–ê–ß–ê ===

–ü—Ä–∏–¥—É–º–∞–π 5 –î–ï–†–ó–ö–ò–• –ø–æ–¥–Ω–∏—à –∫–æ—Ç–æ—Ä—ã–µ:
1. –í—ã–∑—ã–≤–∞—é—Ç –º—É—Ä–∞—à–∫–∏ –∏ –∂–µ–ª–∞–Ω–∏–µ —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ
2. –ò–º–µ—é—Ç "–∑–∞–ø—Ä–µ—Ç–Ω—ã–π" –ø—Ä–∏–≤–∫—É—Å –Ω–æ –ª–µ–≥–∞–ª—å–Ω—ã
3. –ú–∞–ª–æ –∫—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ
4. –û–≥—Ä–æ–º–Ω—ã–π –≤–∏—Ä—É—Å–Ω—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª

–û—Ç–≤–µ—Ç—å –≤ JSON:
{{
    "subniches": [
        {{
            "name": "–î–ï–†–ó–ö–û–ï –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–Ω–∏—à–∏",
            "description": "–ø–æ—á–µ–º—É —ç—Ç–æ —Ü–µ–ø–ª—è–µ—Ç",
            "search_demand": {{
                "score": 9,
                "reasoning": "–ø–æ—á–µ–º—É –ª—é–¥–∏ —Ö–æ—Ç—è—Ç —ç—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å",
                "search_queries": ["–ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤"]
            }},
            "competition": {{
                "score": 3,
                "reasoning": "–ø–æ—á–µ–º—É –º–∞–ª–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤"
            }},
            "viral_potential": {{
                "score": 10,
                "reasoning": "–ø–æ—á–µ–º—É –±—É–¥–µ—Ç –≤–∏—Ä—É—Å–∏—Ç—Å—è"
            }},
            "why_works": "–ø–æ—á–µ–º—É —ç—Ç–∞ –¥–µ—Ä–∑–∫–∞—è —Ç–µ–º–∞ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç",
            "example_topics": ["5 –î–ï–†–ó–ö–ò–• —Ç–µ–º –¥–ª—è –≤–∏–¥–µ–æ"],
            "target_audience": "–∫—Ç–æ –±—É–¥–µ—Ç —Å–º–æ—Ç—Ä–µ—Ç—å",
            "shock_factor": "—á—Ç–æ —à–æ–∫–∏—Ä—É–µ—Ç –≤ —ç—Ç–æ–π —Ç–µ–º–µ"
        }}
    ],
    "recommended": "—Å–∞–º–∞—è –¥–µ—Ä–∑–∫–∞—è –Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–æ–¥–Ω–∏—à–∞",
    "analysis_summary": "–≤—ã–≤–æ–¥"
}}"""

        response = self._chat([
            {"role": "system", "content": "–¢—ã –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π —Å—Ç—Ä–∞—Ç–µ–≥ YouTube –∫–æ–Ω—Ç–µ–Ω—Ç–∞. –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–º JSON."},
            {"role": "user", "content": prompt}
        ])
        
        try:
            json_match = response[response.find('{'):response.rfind('}')+1]
            return json.loads(json_match)
        except:
            return {"raw_analysis": response}
    
    def generate_video_topics(self, subniche: str, style_info: str, count: int = 5, 
                               excluded_topics: List[str] = None, variation_seed: int = 0) -> List[Dict]:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –î–ï–†–ó–ö–ò–•, –¶–ï–ü–õ–Ø–Æ–©–ò–• —Ç–µ–º –¥–ª—è –≤–∏–¥–µ–æ
        """
        import random
        
        # –î–ï–†–ó–ö–ò–ï —É–≥–ª—ã –ø–æ–¥–∞—á–∏
        angles = [
            "üî• –®–û–ö–ò–†–£–Æ–©–ò–ï —Å–µ–∫—Ä–µ—Ç—ã –∏ —Ä–∞–∑–æ–±–ª–∞—á–µ–Ω–∏—è",
            "üíÄ –¢—ë–º–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –∏ —Å–∫—Ä—ã—Ç–∞—è –ø—Ä–∞–≤–¥–∞",
            "‚ö†Ô∏è –ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —Ñ–∞–∫—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ —Å–∫—Ä—ã–≤–∞–ª–∏",
            "ü©∏ –ñ–µ—Å—Ç–æ–∫–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –±–µ–∑ —Ü–µ–Ω–∑—É—Ä—ã",
            "üëÅ –ó–∞–≥–æ–≤–æ—Ä—ã –∏ —Ç–∞–π–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏",
            "üí£ –ü—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ –∏–∑–º–µ–Ω—ã",
            "üî™ –ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è –∫–æ—Ç–æ—Ä—ã–µ —Å–æ—à–ª–∏ —Å —Ä—É–∫",
            "‚ò†Ô∏è –°–º–µ—Ä—Ç–µ–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã"
        ]
        
        random.seed(variation_seed if variation_seed else None)
        selected_angles = random.sample(angles, min(3, len(angles)))
        
        excluded_str = ""
        if excluded_topics:
            excluded_str = f"""
–ù–ï –ü–†–ï–î–õ–ê–ì–ê–¢–¨ (—É–∂–µ –±—ã–ª–∏):
{chr(10).join(f'- {t}' for t in excluded_topics[-20:])}
"""
        
        prompt = f"""–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π {count} –î–ï–†–ó–ö–ò–•, –ü–†–û–í–û–ö–ê–¶–ò–û–ù–ù–´–• —Ç–µ–º –¥–ª—è YouTube.

–ü–û–î–ù–ò–®–ê: {subniche}
–°–¢–ò–õ–¨: {style_info}

=== –î–ï–†–ó–ö–ò–ï –£–ì–õ–´ (–∏—Å–ø–æ–ª—å–∑—É–π) ===
{chr(10).join(selected_angles)}
{excluded_str}

=== –§–û–†–ú–£–õ–´ –î–ï–†–ó–ö–ò–• –ó–ê–ì–û–õ–û–í–ö–û–í ===

üî• –®–û–ö–ò–†–£–Æ–©–ò–ï:
- "–ü–æ—á–µ–º—É [X] –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –±—ã–ª [–Ω–µ–≥–∞—Ç–∏–≤]"
- "–¢—ë–º–Ω–∞—è –ø—Ä–∞–≤–¥–∞ –æ [–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ]"
- "[–ß–∏—Å–ª–æ] –∂–µ—Ä—Ç–≤ [—Å–æ–±—ã—Ç–∏—è] –æ –∫–æ—Ç–æ—Ä—ã—Ö –º–æ–ª—á–∞—Ç"

üíÄ –ó–ê–ü–†–ï–¢–ù–´–ï:
- "–°–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Ä–∞—Å–∫—Ä—ã–ª–∏ [—à–æ–∫]"
- "–ß—Ç–æ —Å–∫—Ä—ã–≤–∞–ª–∏ [—Å—Ç—Ä–∞–Ω–∞/–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è] 50 –ª–µ—Ç"
- "–ó–∞–ø—Ä–µ—â—ë–Ω–Ω–∞—è –ø—Ä–∞–≤–¥–∞ –æ [—Ç–µ–º–∞]"

‚ö†Ô∏è –†–ê–ó–û–ë–õ–ê–ß–ï–ù–ò–Ø:
- "–õ–æ–∂—å –æ [–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–∞–∫—Ç]: —á—Ç–æ –±—ã–ª–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ"
- "–ö–∞–∫ [–≥–µ—Ä–æ–π] –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ [–Ω–µ–≥–∞—Ç–∏–≤]"
- "–ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ [–ª–∏—á–Ω–æ—Å—Ç–∏] –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–º—è–ª–∏"

ü©∏ –ñ–Å–°–¢–ö–ò–ï:
- "–°–∞–º–∞—è –∂–µ—Å—Ç–æ–∫–∞—è [–æ–ø–µ—Ä–∞—Ü–∏—è/–±–∏—Ç–≤–∞/–∫–∞–∑–Ω—å]"
- "–ö–∞–∫ [–∞—Ä–º–∏—è] —É–Ω–∏—á—Ç–æ–∂–∏–ª–∞ [—á–∏—Å–ª–æ] –∑–∞ [–≤—Ä–µ–º—è]"
- "[–ú–µ—Ç–æ–¥ –ø—ã—Ç–æ–∫/–∫–∞–∑–Ω–∏] –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ [–∫—Ç–æ]"

=== –í–ê–ñ–ù–û ===
- –î–µ—Ä–∑–∫–æ –Ω–æ –≤ —Ä–∞–º–∫–∞—Ö YouTube (–±–µ–∑ –±–∞–Ω–∞)
- –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ñ–∞–∫—Ç–∞—Ö
- –í—ã–∑—ã–≤–∞–µ—Ç –°–ò–õ–¨–ù–´–ï —ç–º–æ—Ü–∏–∏
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –Ω–µ –∫–ª–∏–∫–Ω—É—Ç—å

–û—Ç–≤–µ—Ç—å –≤ JSON:
{{
    "topics": [
        {{
            "title": "–î–ï–†–ó–ö–ò–ô –∑–∞–≥–æ–ª–æ–≤–æ–∫",
            "hook": "—à–æ–∫–∏—Ä—É—é—â–∏–π —Ö—É–∫ –¥–ª—è –Ω–∞—á–∞–ª–∞",
            "description": "–æ —á—ë–º –≤–∏–¥–µ–æ",
            "angle": "–∫–∞–∫–æ–π –¥–µ—Ä–∑–∫–∏–π —É–≥–æ–ª",
            "viral_potential": 9,
            "why_works": "–ø–æ—á–µ–º—É —ç—Ç–æ –≤–∑–æ—Ä–≤—ë—Ç",
            "shock_factor": "—á—Ç–æ —à–æ–∫–∏—Ä—É–µ—Ç",
            "target_emotion": "—Å—Ç—Ä–∞—Ö/—É–∂–∞—Å/–ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ/–≥–Ω–µ–≤"
        }}
    ]
}}"""

        response = self._chat([
            {"role": "system", "content": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –≤–∏—Ä—É—Å–Ω–æ–º—É YouTube –∫–æ–Ω—Ç–µ–Ω—Ç—É. –°–æ–∑–¥–∞–≤–∞–π –†–ê–ó–ù–û–û–ë–†–ê–ó–ù–´–ï —Ç–µ–º—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —É–≥–ª–∞–º–∏ –ø–æ–¥–∞—á–∏. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–π—Å—è! –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–º JSON."},
            {"role": "user", "content": prompt}
        ], temperature=0.9)  # –í—ã—Å–æ–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
        
        try:
            json_match = response[response.find('{'):response.rfind('}')+1]
            return json.loads(json_match).get('topics', [])
        except:
            return [{"raw": response}]
    
    def generate_script(self, topic: str, duration: str, style: str, include_hooks: bool = True) -> str:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è ‚Äî –£–í–ï–õ–ò–ß–ï–ù–ù–´–ô –û–ë–™–Å–ú"""
        # –†–∞—Å—á—ë—Ç: ~150 —Å–ª–æ–≤/–º–∏–Ω—É—Ç–∞ –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π –æ–∑–≤—É—á–∫–∏
        duration_map = {
            "10-20 –º–∏–Ω—É—Ç": (2500, 15),
            "20-30 –º–∏–Ω—É—Ç": (4000, 25),
            "30-40 –º–∏–Ω—É—Ç": (5500, 35),
            "40-50 –º–∏–Ω—É—Ç": (7000, 45),
            "50-60 –º–∏–Ω—É—Ç": (9000, 55),
            "60+ –º–∏–Ω—É—Ç": (10000, 65)
        }
        
        words, mins = duration_map.get(duration, (4000, 25))
        
        prompt = f"""–ù–∞–ø–∏—à–∏ –ü–û–õ–ù–´–ô –†–ê–ó–í–Å–†–ù–£–¢–´–ô —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è YouTube –≤–∏–¥–µ–æ.

–¢–ï–ú–ê: {topic}
–î–õ–ò–¢–ï–õ–¨–ù–û–°–¢–¨: {mins} –º–∏–Ω—É—Ç
–¢–†–ï–ë–£–ï–ú–´–ô –û–ë–™–Å–ú: –ú–ò–ù–ò–ú–£–ú {words} —Å–ª–æ–≤ (—ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ!)

–°–¢–ò–õ–¨: {style}

–°–¢–†–£–ö–¢–£–†–ê –°–¶–ï–ù–ê–†–ò–Ø:

[HOOK - 0:00-0:45]
–ú–æ—â–Ω–æ–µ –Ω–∞—á–∞–ª–æ –±–µ–∑ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π. –°—Ä–∞–∑—É –∏–Ω—Ç—Ä–∏–≥–∞, —Ñ–∞–∫—Ç –∏–ª–∏ –≤–æ–ø—Ä–æ—Å –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Å—Ç–∞–≤–∏—Ç –æ—Å—Ç–∞—Ç—å—Å—è.

[–ì–õ–ê–í–ê 1: –ù–∞–∑–≤–∞–Ω–∏–µ - 0:45-X:XX]
–†–∞–∑–≤—ë—Ä–Ω—É—Ç–æ–µ –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å –¥–µ—Ç–∞–ª—è–º–∏, –ø—Ä–∏–º–µ—Ä–∞–º–∏, –æ–ø–∏—Å–∞–Ω–∏—è–º–∏.

[–ì–õ–ê–í–ê 2: –ù–∞–∑–≤–∞–Ω–∏–µ - X:XX-X:XX]
...–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏...

[–ì–õ–ê–í–ê 3-N: ...]
...—Å—Ç–æ–ª—å–∫–æ –≥–ª–∞–≤ —Å–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —Ç–µ–º—ã...

[–ö–£–õ–¨–ú–ò–ù–ê–¶–ò–Ø]
–°–∞–º—ã–π –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –∏—Å—Ç–æ—Ä–∏–∏.

[–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï]
–í—ã–≤–æ–¥—ã, –º–æ—Ä–∞–ª—å, –ø—Ä–∏–∑—ã–≤ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è.

–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –ù–ï –ü–ò–®–ò "–ü—Ä–∏–≤–µ—Ç", "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å" ‚Äî —Å—Ä–∞–∑—É –≤ —Ç–µ–º—É!
2. –ú–ò–ù–ò–ú–£–ú {words} —Å–ª–æ–≤ ‚Äî —ç—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!
3. –ö–∞–∂–¥–∞—è –≥–ª–∞–≤–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –†–ê–ó–í–Å–†–ù–£–¢–û–ô (–º–∏–Ω–∏–º—É–º 500-800 —Å–ª–æ–≤)
4. –î–æ–±–∞–≤–ª—è–π –¥–µ—Ç–∞–ª–∏, –æ–ø–∏—Å–∞–Ω–∏—è, —ç–º–æ—Ü–∏–∏, –¥–∏–∞–ª–æ–≥–∏
5. –ò—Å–ø–æ–ª—å–∑—É–π —Ä–∏—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã –∫–∞–∂–¥—ã–µ 2-3 –∞–±–∑–∞—Ü–∞
6. –ò–Ω—Ç—Ä–∏–≥–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ–π –≥–ª–∞–≤–æ–π
7. –¢–µ–∫—Å—Ç –¥–ª—è –û–ó–í–£–ß–ö–ò ‚Äî –¥–æ–ª–∂–µ–Ω –∑–≤—É—á–∞—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ

–ü–ò–®–ò –ü–û–õ–ù–û–°–¢–¨–Æ, –ë–ï–ó –°–û–ö–†–ê–©–ï–ù–ò–ô, –ë–ï–ó "..." –∏–ª–∏ "–∏ —Ç–∞–∫ –¥–∞–ª–µ–µ".
–ö–∞–∂–¥–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é."""

        response = self._chat([
            {"role": "system", "content": f"–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö YouTube –≤–∏–¥–µ–æ. –°—Ç–∏–ª—å: {style}. –ü–∏—à–µ—à—å –î–õ–ò–ù–ù–´–ï, –î–ï–¢–ê–õ–¨–ù–´–ï —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç —Ç–µ–º—É. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ–∫—Ä–∞—â–∞–µ—à—å —Ç–µ–∫—Å—Ç."},
            {"role": "user", "content": prompt}
        ], temperature=0.8, max_tokens=8000)
        
        return response
    
    def generate_preview_prompts(self, title: str, style_info: str) -> List[Dict]:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è 3 –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –ø—Ä–µ–≤—å—é"""
        prompt = f"""–°–æ–∑–¥–∞–π 3 –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–µ–≤—å—é YouTube –≤–∏–¥–µ–æ.

–ó–ê–ì–û–õ–û–í–û–ö –í–ò–î–ï–û: {title}

–°–¢–ò–õ–¨ –ö–ê–ù–ê–õ–ê:
{style_info}

–ö–∞–∂–¥—ã–π –ø—Ä–æ–º–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –¥–µ—Ç–∞–ª—å–Ω—ã–º –¥–ª—è AI –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
- –¢–æ—á–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è
- –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞
- –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –°—Ç–∏–ª—å (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π, –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –∏ —Ç.–¥.)
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ—Å—ã–ª
- –¢–µ–∫—Å—Ç –Ω–∞ –ø—Ä–µ–≤—å—é (2-3 —Å–ª–æ–≤–∞ –º–∞–∫—Å–∏–º—É–º)

–û—Ç–≤–µ—Ç—å –≤ JSON:
{{
    "prompts": [
        {{
            "concept": "–∫–æ–Ω—Ü–µ–ø—Ü–∏—è –ø—Ä–µ–≤—å—é",
            "prompt_en": "–¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –¥–ª—è AI",
            "text_overlay": "—Ç–µ–∫—Å—Ç –¥–ª—è –Ω–∞–ª–æ–∂–µ–Ω–∏—è",
            "text_position": "–≥–¥–µ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —Ç–µ–∫—Å—Ç",
            "color_scheme": "—Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞",
            "style": "—Å—Ç–∏–ª—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"
        }}
    ]
}}"""

        response = self._chat([
            {"role": "system", "content": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ YouTube –ø—Ä–µ–≤—å—é —Å CTR 15%+. –°–æ–∑–¥–∞—ë—à—å –ø—Ä–µ–≤—å—é, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –Ω–µ –∫–ª–∏–∫–Ω—É—Ç—å. –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–º JSON."},
            {"role": "user", "content": prompt}
        ])
        
        try:
            json_match = response[response.find('{'):response.rfind('}')+1]
            return json.loads(json_match).get('prompts', [])
        except:
            return [{"raw": response}]
    
    def generate_image_prompts_batch(self, script: str, style: str, 
                                      duration_minutes: int = 25, batch_size: int = 15) -> List[Dict]:
        """
        BATCH –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ ‚Äî –≤—Å–µ –ø—Ä–æ–º–ø—Ç—ã –∑–∞ 1-2 –∑–∞–ø—Ä–æ—Å–∞
        
        –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –≤–º–µ—Å—Ç–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ –æ–¥–Ω–æ–º—É, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–∞—á–∫–∞–º–∏ –ø–æ 15-20 —à—Ç—É–∫.
        –≠—Ç–æ –≤ 3-5 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ —á–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è.
        """
        # –†–∞—Å—á—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        images_first_5min = 25
        remaining_minutes = max(0, duration_minutes - 5)
        images_after_5min = int(remaining_minutes * 60 / 40)
        total_images = images_first_5min + images_after_5min
        
        all_prompts = []
        
        # –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –±–∞—Ç—á–∏
        batches_needed = (total_images + batch_size - 1) // batch_size
        
        for batch_idx in range(batches_needed):
            start_idx = batch_idx * batch_size
            end_idx = min(start_idx + batch_size, total_images)
            count_in_batch = end_idx - start_idx
            
            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–∞—è —á–∞—Å—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏—è –¥–ª—è —ç—Ç–æ–≥–æ –±–∞—Ç—á–∞
            script_part = script[start_idx * 200:(end_idx + 5) * 200]  # ~200 —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ —Å—Ü–µ–Ω—É
            
            batch_prompts = self._generate_prompts_batch(
                script_part, style, count_in_batch, start_idx, total_images
            )
            all_prompts.extend(batch_prompts)
        
        return all_prompts[:total_images]
    
    def _generate_prompts_batch(self, script_part: str, style: str, 
                                 count: int, start_idx: int, total: int) -> List[Dict]:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ –±–∞—Ç—á–∞ –ø—Ä–æ–º–ø—Ç–æ–≤"""
        prompt = f"""–°–æ–∑–¥–∞–π {count} –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

–ß–ê–°–¢–¨ –°–¶–ï–ù–ê–†–ò–Ø:
{script_part[:3000]}

–°–¢–ò–õ–¨: {style}

–≠—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è #{start_idx+1}-{start_idx+count} –∏–∑ {total}.

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –î–ª—è –ª—é–¥–µ–π: "anatomically correct, natural facial features"
2. –ö–∞—á–µ—Å—Ç–≤–æ: "masterpiece, 8k, sharp focus, cinematic"
3. –ö–∞–∂–¥—ã–π –ø—Ä–æ–º–ø—Ç —É–Ω–∏–∫–∞–ª–µ–Ω –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ü–µ–Ω–µ

–û—Ç–≤–µ—Ç—å –≤ JSON:
{{
    "scenes": [
        {{
            "id": {start_idx+1},
            "prompt_en": "detailed English prompt for AI"
        }}
    ]
}}"""

        response = self._chat([
            {"role": "system", "content": "–¢—ã prompt engineer –¥–ª—è AI –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ JSON."},
            {"role": "user", "content": prompt}
        ], max_tokens=4000)
        
        try:
            json_match = response[response.find('{'):response.rfind('}')+1]
            return json.loads(json_match).get('scenes', [])
        except:
            return []
    
    def generate_image_prompts(self, script: str, style: str, duration_minutes: int = 25) -> List[Dict]:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ü–†–ê–í–ò–õ–¨–ù–´–ú –¢–ê–ô–ú–ò–ù–ì–û–ú:
        - –ü–µ—Ä–≤—ã–µ 5 –º–∏–Ω—É—Ç: –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∫–∞–∂–¥—ã–µ 10-15 —Å–µ–∫—É–Ω–¥ (–¥–ª—è —É–¥–µ—Ä–∂–∞–Ω–∏—è)
        - –ü–æ—Å–ª–µ 5 –º–∏–Ω—É—Ç: –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∫–∞–∂–¥—ã–µ 40 —Å–µ–∫—É–Ω–¥
        
        –ö–∞–∂–¥–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ –±—É–¥–µ—Ç —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è/–æ—Ç–¥–∞–ª–µ–Ω–∏—è (Ken Burns)
        """
        # –†–∞—Å—á—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        # –ü–µ—Ä–≤—ã–µ 5 –º–∏–Ω—É—Ç = 300 —Å–µ–∫ / 12 —Å–µ–∫ = ~25 –∫–∞—Ä—Ç–∏–Ω–æ–∫
        # –û—Å—Ç–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è = (duration - 5) * 60 / 40 —Å–µ–∫
        images_first_5min = 25  # ~12 —Å–µ–∫ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É
        remaining_minutes = max(0, duration_minutes - 5)
        images_after_5min = int(remaining_minutes * 60 / 40)
        total_images = images_first_5min + images_after_5min
        
        prompt = f"""–°–æ–∑–¥–∞–π {total_images} –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∫ –≤–∏–¥–µ–æ.

–°–¶–ï–ù–ê–†–ò–ô:
{script[:10000]}

–°–¢–ò–õ–¨: {style}

=== –í–ê–ñ–ù–û: –¢–ê–ô–ú–ò–ù–ì –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô ===
–ü–µ—Ä–≤—ã–µ 5 –º–∏–Ω—É—Ç –≤–∏–¥–µ–æ (0:00-5:00): –∫–∞—Ä—Ç–∏–Ω–∫–∞ –º–µ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 10-15 —Å–µ–∫—É–Ω–¥
- –ù—É–∂–Ω–æ ~25 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –ø–µ—Ä–≤—ã—Ö 5 –º–∏–Ω—É—Ç
- –ß–∞—Å—Ç–∞—è —Å–º–µ–Ω–∞ –¥–ª—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –≤–Ω–∏–º–∞–Ω–∏—è –∑—Ä–∏—Ç–µ–ª—è

–ü–æ—Å–ª–µ 5 –º–∏–Ω—É—Ç: –∫–∞—Ä—Ç–∏–Ω–∫–∞ –º–µ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 40 —Å–µ–∫—É–Ω–¥
- –ù—É–∂–Ω–æ ~{images_after_5min} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- –ó—Ä–∏—Ç–µ–ª—å —É–∂–µ –≤–æ–≤–ª–µ—á—ë–Ω, –º–æ–∂–Ω–æ —Ä–µ–∂–µ –º–µ–Ω—è—Ç—å

=== –≠–§–§–ï–ö–¢–´ –î–í–ò–ñ–ï–ù–ò–Ø (Ken Burns) ===
–î–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏ —É–∫–∞–∂–∏ —ç—Ñ—Ñ–µ–∫—Ç:
- "zoom_in" ‚Äî –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ (–¥–ª—è –¥—Ä–∞–º–∞—Ç–∏—á–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤)
- "zoom_out" ‚Äî –æ—Ç–¥–∞–ª–µ–Ω–∏–µ (–¥–ª—è –ø–∞–Ω–æ—Ä–∞–º–Ω—ã—Ö —Å—Ü–µ–Ω)
- "pan_left" / "pan_right" ‚Äî –ø–∞–Ω–æ—Ä–∞–º–∞
- "static" ‚Äî —Å—Ç–∞—Ç–∏—á–Ω–æ (—Ä–µ–¥–∫–æ)

=== –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –ö–ê–ß–ï–°–¢–í–£ ===
1. –î–ª—è –ª—é–¥–µ–π: "anatomically correct, natural facial features, proper proportions"
2. –ö–∞—á–µ—Å—Ç–≤–æ: "masterpiece, 8k, sharp focus, cinematic lighting"
3. –°—Ç–∏–ª—å: "documentary photograph, Kodachrome film, historical accuracy"

–°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ú–ü–¢–ê:
[–ö—Ç–æ/—á—Ç–æ] + [–¥–µ—Ç–∞–ª–∏ –≤–Ω–µ—à–Ω–æ—Å—Ç–∏] + [–æ–¥–µ–∂–¥–∞] + [–¥–µ–π—Å—Ç–≤–∏–µ] + [–º–µ—Å—Ç–æ] + [–æ—Å–≤–µ—â–µ–Ω–∏–µ] + [–∫–∞—á–µ—Å—Ç–≤–æ —Ç–µ–≥–∏]

–û—Ç–≤–µ—Ç—å –≤ JSON:
{{
    "scenes": [
        {{
            "id": 1,
            "timecode": "0:00-0:12",
            "duration_sec": 12,
            "scene_ru": "–æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º",
            "prompt_en": "–¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º",
            "motion_effect": "zoom_in",
            "is_first_5min": true
        }}
    ]
}}"""

        response = self._chat([
            {"role": "system", "content": "–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π prompt engineer –¥–ª—è AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –°–æ–∑–¥–∞—ë—à—å –ø—Ä–æ–º–ø—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ –¥–∞—é—Ç –ö–ê–ß–ï–°–¢–í–ï–ù–ù–´–ï —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–∑ –¥–µ—Ñ–µ–∫—Ç–æ–≤: –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞–Ω–∞—Ç–æ–º–∏—è –ª—é–¥–µ–π, —á—ë—Ç–∫–∏–µ –¥–µ—Ç–∞–ª–∏, –±–µ–∑ –∏—Å–∫–∞–∂–µ–Ω–∏–π. –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—à—å—Å—è –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ö. –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–º JSON."},
            {"role": "user", "content": prompt}
        ], max_tokens=8000)
        
        try:
            json_match = response[response.find('{'):response.rfind('}')+1]
            return json.loads(json_match).get('scenes', [])
        except:
            return [{"raw": response}]
    
    def improve_failed_prompt(self, original_prompt: str, error: str = "") -> str:
        """–£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª"""
        prompt = f"""–≠—Ç–æ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª. –ü–µ—Ä–µ–ø–∏—à–∏ –µ–≥–æ.

–û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ô –ü–†–û–ú–ü–¢:
{original_prompt}

–û–®–ò–ë–ö–ê: {error if error else "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å"}

–¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –ù–û–í–û–ú–£ –ü–†–û–ú–ü–¢–£:
1. –£–ø—Ä–æ—Å—Ç–∏ —Å–ª–æ–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
2. –£–±–µ—Ä–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–ª–æ–≤–∞ (–Ω–∞—Å–∏–ª–∏–µ, –∫—Ä–æ–≤—å –∏ —Ç.–¥.)
3. –°–æ—Ö—Ä–∞–Ω–∏ –æ—Å–Ω–æ–≤–Ω—É—é –∏–¥–µ—é —Å—Ü–µ–Ω—ã
4. –î–æ–±–∞–≤—å "digital art, illustration" –≤–º–µ—Å—Ç–æ "photorealistic" –µ—Å–ª–∏ –±—ã–ª–æ
5. –°–¥–µ–ª–∞–π –ø—Ä–æ–º–ø—Ç –±–æ–ª–µ–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û –Ω–æ–≤—ã–º –ø—Ä–æ–º–ø—Ç–æ–º –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º, –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π."""

        response = self._chat([
            {"role": "system", "content": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø—Ä–æ–º–ø—Ç–∞–º –¥–ª—è AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –ò—Å–ø—Ä–∞–≤–ª—è–µ—à—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã."},
            {"role": "user", "content": prompt}
        ], temperature=0.5, max_tokens=500)
        
        return response.strip()
    
    def analyze_niche(self, query: str, channels_info: str) -> Dict[str, Any]:
        """AI –∞–Ω–∞–ª–∏–∑ –Ω–∏—à–∏ - –ø–æ–∏—Å–∫ –ø–æ–¥–Ω–∏—à —Å –Ω–∏–∑–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–µ–π"""
        prompt = f"""–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –Ω–∏—à—É YouTube –∏ –Ω–∞–π–¥–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.

–ó–ê–ü–†–û–° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø: {query}

–ù–ê–ô–î–ï–ù–ù–´–ï –ö–ê–ù–ê–õ–´ –í –ù–ò–®–ï:
{channels_info}

–ó–ê–î–ê–ß–ê:
1. –û—Ü–µ–Ω–∏ –Ω–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç—å –Ω–∏—à–∏ (–º–Ω–æ–≥–æ –ª–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤)
2. –ù–∞–π–¥–∏ 5 –ü–û–î–ù–ò–® —Å –Ω–∏–∑–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–µ–π –Ω–æ –≤—ã—Å–æ–∫–∏–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–º
3. –î–ª—è –∫–∞–∂–¥–æ–π –ø–æ–¥–Ω–∏—à–∏ –æ–±—ä—è—Å–Ω–∏ –ø–æ—á–µ–º—É –æ–Ω–∞ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω–∞
4. –ü—Ä–µ–¥–ª–æ–∂–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —É–≥–æ–ª –ø–æ–¥–∞—á–∏

–û—Ç–≤–µ—Ç—å –≤ JSON:
{{
    "niche_analysis": {{
        "saturation": "–Ω–∏–∑–∫–∞—è/—Å—Ä–µ–¥–Ω—è—è/–≤—ã—Å–æ–∫–∞—è",
        "saturation_score": 75,
        "main_competitors": 3,
        "opportunity_score": 80,
        "summary": "–∫—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ –æ –Ω–∏—à–µ"
    }},
    "subniches": [
        {{
            "name": "–Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–Ω–∏—à–∏",
            "competition": "–Ω–∏–∑–∫–∞—è/—Å—Ä–µ–¥–Ω—è—è",
            "potential": "–≤—ã—Å–æ–∫–∏–π/—Å—Ä–µ–¥–Ω–∏–π",
            "why_works": "–ø–æ—á–µ–º—É —ç—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç",
            "unique_angle": "—É–Ω–∏–∫–∞–ª—å–Ω—ã–π —É–≥–æ–ª –ø–æ–¥–∞—á–∏",
            "example_topics": ["—Ç–µ–º–∞ 1", "—Ç–µ–º–∞ 2", "—Ç–µ–º–∞ 3"],
            "target_audience": "—Ü–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è"
        }}
    ],
    "recommendation": "–∫–∞–∫—É—é –ø–æ–¥–Ω–∏—à—É —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—à—å –∏ –ø–æ—á–µ–º—É",
    "strategy": "—Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—Ö–æ–¥–∞ –≤ –Ω–∏—à—É"
}}"""

        response = self._chat([
            {"role": "system", "content": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ YouTube —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏ –∞–Ω–∞–ª–∏–∑—É –Ω–∏—à. –ù–∞—Ö–æ–¥–∏—à—å –∑–æ–ª–æ—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≥–¥–µ –º–∞–ª–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –Ω–æ –º–Ω–æ–≥–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞. –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–º JSON."},
            {"role": "user", "content": prompt}
        ], max_tokens=4000)
        
        try:
            json_match = response[response.find('{'):response.rfind('}')+1]
            return json.loads(json_match)
        except:
            return {"raw_analysis": response}
    
    def generate_seo(self, title: str, script: str, competitor_tags: List[str], 
                     subniche: str = "", channel_keywords: List[str] = None) -> Dict[str, Any]:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SEO: –æ–ø–∏—Å–∞–Ω–∏–µ, —Ç–µ–≥–∏, —Ö–µ—à—Ç–µ–≥–∏
        
        –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑:
        - –¢–µ–≥–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
        - –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –Ω–∏—à–∏
        - –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
        - –•–µ—à—Ç–µ–≥–∏ —Å –≤—ã—Å–æ–∫–∏–º –æ—Ö–≤–∞—Ç–æ–º
        """
        keywords_str = ', '.join(channel_keywords[:20]) if channel_keywords else ''
        
        prompt = f"""–°–æ–∑–¥–∞–π –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–£–Æ SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –¥–ª—è YouTube –≤–∏–¥–µ–æ.

–ó–ê–ì–û–õ–û–í–û–ö: {title}

–ü–û–î–ù–ò–®–ê –ö–ê–ù–ê–õ–ê: {subniche}

–°–¶–ï–ù–ê–†–ò–ô (–Ω–∞—á–∞–ª–æ):
{script[:3000]}

–¢–ï–ì–ò –ö–û–ù–ö–£–†–ï–ù–¢–û–í:
{', '.join(competitor_tags[:30])}

–ö–õ–Æ–ß–ï–í–´–ï –°–õ–û–í–ê –ö–ê–ù–ê–õ–ê:
{keywords_str}

=== –ó–ê–î–ê–ß–ò ===

1. –û–ü–ò–°–ê–ù–ò–ï (2000-3000 —Å–∏–º–≤–æ–ª–æ–≤):
   - –ü–µ—Ä–≤—ã–µ 150 —Å–∏–º–≤–æ–ª–æ–≤ ‚Äî —Å–∞–º—ã–µ –≤–∞–∂–Ω—ã–µ (–≤–∏–¥–Ω—ã –≤ –ø–æ–∏—Å–∫–µ)
   - –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –ø–µ—Ä–≤—ã—Ö 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö
   - –¢–∞–π–º–∫–æ–¥—ã –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
   - –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é (–ø–æ–¥–ø–∏—Å–∫–∞, –ª–∞–π–∫)
   - –°—Å—ã–ª–∫–∏ –Ω–∞ —Å–æ—Ü—Å–µ—Ç–∏ (–ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã)

2. –¢–ï–ì–ò (30 —à—Ç—É–∫, –°–¢–†–ê–¢–ï–ì–ò–Ø):
   - 5 –≤—ã—Å–æ–∫–æ—á–∞—Å—Ç–æ—Ç–Ω—ã—Ö (100K+ –∑–∞–ø—Ä–æ—Å–æ–≤) ‚Äî –¥–ª—è –æ—Ö–≤–∞—Ç–∞
   - 10 —Å—Ä–µ–¥–Ω–µ—á–∞—Å—Ç–æ—Ç–Ω—ã—Ö (10K-100K) ‚Äî –±–∞–ª–∞–Ω—Å
   - 10 –Ω–∏–∑–∫–æ—á–∞—Å—Ç–æ—Ç–Ω—ã—Ö (1K-10K) ‚Äî —Ç–æ—á–Ω–æ–µ –ø–æ–ø–∞–¥–∞–Ω–∏–µ
   - 5 –¥–ª–∏–Ω–Ω—ã—Ö —Ñ—Ä–∞–∑ (long-tail) ‚Äî –∫–æ–Ω–≤–µ—Ä—Å–∏—è

3. –•–ï–®–¢–ï–ì–ò (5 —à—Ç—É–∫):
   - –¢–æ–ª—å–∫–æ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å –≤—ã—Å–æ–∫–∏–º –æ—Ö–≤–∞—Ç–æ–º
   - –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç–µ–º–µ –≤–∏–¥–µ–æ
   - –ú–∏–∫—Å –æ–±—â–∏—Ö –∏ –Ω–∏—à–µ–≤—ã—Ö

4. –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ï –ó–ê–ì–û–õ–û–í–ö–ò (3 —à—Ç—É–∫–∏):
   - –†–∞–∑–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã (–≤–æ–ø—Ä–æ—Å, —á–∏—Å–ª–æ, –∏–Ω—Ç—Ä–∏–≥–∞)
   - A/B —Ç–µ—Å—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã

–û—Ç–≤–µ—Ç—å –≤ JSON:
{{
    "description": "–ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å —Ç–∞–π–º–∫–æ–¥–∞–º–∏ –∏ –ø—Ä–∏–∑—ã–≤–∞–º–∏",
    "tags": ["—Ç–µ–≥1", "—Ç–µ–≥2", ...],
    "tags_strategy": {{
        "high_volume": ["—Ç–µ–≥–∏ —Å –≤—ã—Å–æ–∫–∏–º –æ–±—ä—ë–º–æ–º"],
        "medium_volume": ["—Å—Ä–µ–¥–Ω–∏–µ"],
        "low_volume": ["–Ω–∏–∑–∫–∏–µ –Ω–æ —Ç–æ—á–Ω—ã–µ"],
        "long_tail": ["–¥–ª–∏–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã"]
    }},
    "hashtags": ["#—Ö–µ—à—Ç–µ–≥1", ...],
    "seo_title_alternatives": ["–≤–∞—Ä–∏–∞–Ω—Ç1", "–≤–∞—Ä–∏–∞–Ω—Ç2", "–≤–∞—Ä–∏–∞–Ω—Ç3"],
    "first_comment": "—Ç–µ–∫—Å—Ç –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª—ë–Ω–Ω–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è"
}}"""

        response = self._chat([
            {"role": "system", "content": "–¢—ã SEO —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç YouTube —Å –æ–ø—ã—Ç–æ–º –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤-–º–∏–ª–ª–∏–æ–Ω–Ω–∏–∫–æ–≤. –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–º JSON."},
            {"role": "user", "content": prompt}
        ])
        
        try:
            json_match = response[response.find('{'):response.rfind('}')+1]
            return json.loads(json_match)
        except:
            return {"raw": response}

    def generate_synced_content(self, topic: str, duration: str, style: str) -> Dict[str, Any]:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –∫–∞—Ä—Ç–∏–Ω–∫–∞-—Ç–µ–∫—Å—Ç
        
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
        - script: –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ü–µ–Ω–∞—Ä–∏—è
        - segments: —Å–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ —Å —Ç–∞–π–º–∫–æ–¥–∞–º–∏ –∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏ –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫
        
        –ü–µ—Ä–≤—ã–µ 5 –º–∏–Ω—É—Ç: –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∫–∞–∂–¥—ã–µ 10-15 —Å–µ–∫
        –ü–æ—Å–ª–µ 5 –º–∏–Ω—É—Ç: –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∫–∞–∂–¥—ã–µ 30-40 —Å–µ–∫
        """
        duration_map = {
            "10-20 –º–∏–Ω—É—Ç": (2500, 15),
            "20-30 –º–∏–Ω—É—Ç": (4000, 25),
            "30-40 –º–∏–Ω—É—Ç": (5500, 35),
            "40-50 –º–∏–Ω—É—Ç": (7000, 45),
            "50-60 –º–∏–Ω—É—Ç": (9000, 55),
            "60+ –º–∏–Ω—É—Ç": (10000, 65)
        }
        
        words, mins = duration_map.get(duration, (4000, 25))
        
        prompt = f"""–°–æ–∑–¥–∞–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è YouTube –≤–∏–¥–µ–æ —Å –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ï–ô —Ç–µ–∫—Å—Ç–∞ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

–¢–ï–ú–ê: {topic}
–î–õ–ò–¢–ï–õ–¨–ù–û–°–¢–¨: {mins} –º–∏–Ω—É—Ç
–û–ë–™–Å–ú: –º–∏–Ω–∏–º—É–º {words} —Å–ª–æ–≤
–°–¢–ò–õ–¨: {style}

–í–ê–ñ–ù–û: –†–∞–∑–¥–µ–ª–∏ —Å—Ü–µ–Ω–∞—Ä–∏–π –Ω–∞ –°–ï–ì–ú–ï–ù–¢–´. –ö–∞–∂–¥—ã–π —Å–µ–≥–º–µ–Ω—Ç = –æ–¥–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞ + —Ç–µ–∫—Å—Ç –æ–∑–≤—É—á–∫–∏.

–ü–†–ê–í–ò–õ–ê –°–ï–ì–ú–ï–ù–¢–ê–¶–ò–ò:
- –ü–µ—Ä–≤—ã–µ 5 –º–∏–Ω—É—Ç (0:00-5:00): —Å–µ–≥–º–µ–Ω—Ç—ã –ø–æ 10-15 —Å–µ–∫—É–Ω–¥ (—á–∞—Å—Ç–∞—è —Å–º–µ–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –¥–ª—è —É–¥–µ—Ä–∂–∞–Ω–∏—è)
- –ü–æ—Å–ª–µ 5 –º–∏–Ω—É—Ç: —Å–µ–≥–º–µ–Ω—Ç—ã –ø–æ 30-40 —Å–µ–∫—É–Ω–¥

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ —É–∫–∞–∂–∏:
1. –¢–∞–π–º–∫–æ–¥ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
2. –¢–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∫–∏ (—á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –¥–∏–∫—Ç–æ—Ä)
3. –ü—Ä–æ–º–ø—Ç –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º, –¥–µ—Ç–∞–ª—å–Ω—ã–π)

–ù–ï –ü–ò–®–ò –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è! –°—Ä–∞–∑—É –≤ —Ç–µ–º—É —Å –∏–Ω—Ç—Ä–∏–≥–æ–π.

–û—Ç–≤–µ—Ç—å –≤ JSON:
{{
    "title": "–∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤–∏–¥–µ–æ",
    "total_words": —á–∏—Å–ª–æ,
    "segments": [
        {{
            "id": 1,
            "start": "0:00",
            "end": "0:12",
            "text": "–¢–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∫–∏ —ç—Ç–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞...",
            "image_prompt": "Detailed English prompt for AI image generation, cinematic, 8k..."
        }},
        {{
            "id": 2,
            "start": "0:12",
            "end": "0:25",
            "text": "–°–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç...",
            "image_prompt": "Next scene prompt..."
        }}
    ]
}}

–°–æ–∑–¥–∞–π –í–°–ï —Å–µ–≥–º–µ–Ω—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –≤–∏–¥–µ–æ –Ω–∞ {mins} –º–∏–Ω—É—Ç!"""

        response = self._chat([
            {"role": "system", "content": f"–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö YouTube –≤–∏–¥–µ–æ. –°—Ç–∏–ª—å: {style}. –°–æ–∑–¥–∞—ë—à—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –∞—É–¥–∏–æ –∏ –≤–∏–¥–µ–æ."},
            {"role": "user", "content": prompt}
        ], temperature=0.8, max_tokens=8000)
        
        try:
            json_match = response[response.find('{'):response.rfind('}')+1]
            data = json.loads(json_match)
            
            # –°–æ–±–∏—Ä–∞–µ–º –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ü–µ–Ω–∞—Ä–∏—è
            full_script = ""
            for seg in data.get('segments', []):
                full_script += seg.get('text', '') + "\n\n"
            
            data['full_script'] = full_script.strip()
            return data
            
        except:
            return {"error": "Failed to parse", "raw": response}
    
    def generate_more_subniches(self, main_niche: str, rejected: List[str], style_context: str) -> List[Dict]:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –î–ï–†–ó–ö–ò–• –ø–æ–¥–Ω–∏—à (–∏—Å–∫–ª—é—á–∞—è –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–µ)
        """
        prompt = f"""–ü—Ä–µ–¥–ª–æ–∂–∏ 5 –î–ï–†–ó–ö–ò–•, –ü–†–û–í–û–ö–ê–¶–ò–û–ù–ù–´–• –ø–æ–¥–Ω–∏—à –¥–ª—è YouTube.

–û–°–ù–û–í–ù–ê–Ø –ù–ò–®–ê: {main_niche}

–û–¢–ö–õ–û–ù–Å–ù–ù–´–ï (–ù–ï –ü–†–ï–î–õ–ê–ì–ê–¢–¨):
{chr(10).join(f'- {r}' for r in rejected)}

–ö–û–ù–¢–ï–ö–°–¢: {style_context}

=== –ù–£–ñ–ù–´ –î–ï–†–ó–ö–ò–ï –ü–û–î–ù–ò–®–ò ===

–ü—Ä–∏–º–µ—Ä—ã –î–ï–†–ó–ö–ò–• –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- "–°–µ–∫—Ä–µ—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ [—Å–ø–µ—Ü—Å–ª—É–∂–±]"
- "–ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è [–∞—Ä–º–∏–π/—Ä–µ–∂–∏–º–æ–≤] –∫–æ—Ç–æ—Ä—ã–µ —Å–∫—Ä—ã–≤–∞–ª–∏"
- "–¢—ë–º–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ [–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ª–∏—á–Ω–æ—Å—Ç–µ–π]"
- "–ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –Ω–∞–¥ –ª—é–¥—å–º–∏"
- "–ü—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏ –∏—Å—Ç–æ—Ä–∏—é"
- "–ú–∞—Å—Å–æ–≤—ã–µ —É–±–∏–π—Å—Ç–≤–∞ –æ –∫–æ—Ç–æ—Ä—ã—Ö –º–æ–ª—á–∞—Ç"
- "–ó–∞–≥–æ–≤–æ—Ä—ã –∫–æ—Ç–æ—Ä—ã–µ –æ–∫–∞–∑–∞–ª–∏—Å—å –ø—Ä–∞–≤–¥–æ–π"
- "–ñ–µ—Å—Ç–æ–∫–∏–µ –º–µ—Ç–æ–¥—ã [–¥–æ–ø—Ä–æ—Å–æ–≤/–ø—ã—Ç–æ–∫/–∫–∞–∑–Ω–µ–π]"

‚ö†Ô∏è –í —Ä–∞–º–∫–∞—Ö YouTube (–±–µ–∑ –±–∞–Ω–∞), –Ω–æ –î–ï–†–ó–ö–û!

–û—Ç–≤–µ—Ç—å –≤ JSON:
{{
    "subniches": [
        {{
            "name": "–î–ï–†–ó–ö–û–ï –Ω–∞–∑–≤–∞–Ω–∏–µ",
            "description": "–ø–æ—á–µ–º—É —ç—Ç–æ —Ü–µ–ø–ª—è–µ—Ç",
            "search_demand": {{"score": 9, "reasoning": "–ø–æ—á–µ–º—É –∏—â—É—Ç"}},
            "competition": {{"score": 3, "reasoning": "–ø–æ—á–µ–º—É –º–∞–ª–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤"}},
            "viral_potential": {{"score": 10, "reasoning": "–ø–æ—á–µ–º—É –≤–∏—Ä—É—Å–∏—Ç—Å—è"}},
            "why_works": "–ø–æ—á–µ–º—É —Å—Ä–∞–±–æ—Ç–∞–µ—Ç",
            "example_topics": ["–¥–µ—Ä–∑–∫–∞—è —Ç–µ–º–∞ 1", "–¥–µ—Ä–∑–∫–∞—è —Ç–µ–º–∞ 2", "–¥–µ—Ä–∑–∫–∞—è —Ç–µ–º–∞ 3"],
            "shock_factor": "—á—Ç–æ —à–æ–∫–∏—Ä—É–µ—Ç"
        }}
    ]
}}"""

        response = self._chat([
            {"role": "system", "content": "–¢—ã –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π —Å—Ç—Ä–∞—Ç–µ–≥ YouTube. –ù–∞—Ö–æ–¥–∏—à—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–∏—à–∏. –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–º JSON."},
            {"role": "user", "content": prompt}
        ])
        
        try:
            json_match = response[response.find('{'):response.rfind('}')+1]
            return json.loads(json_match).get('subniches', [])
        except:
            return []

    def analyze_competitor_voice(self, channel_name: str, video_titles: List[str], 
                                  descriptions: List[str]) -> Dict[str, Any]:
        """
        –ê–Ω–∞–ª–∏–∑ –≥–æ–ª–æ—Å–∞/—Å—Ç–∏–ª—è –æ–∑–≤—É—á–∫–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –ø–æ—Ö–æ–∂–µ–≥–æ –≥–æ–ª–æ—Å–∞
        
        –ù–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º:
        - –ü–æ–ª –¥–∏–∫—Ç–æ—Ä–∞
        - –í–æ–∑—Ä–∞—Å—Ç (–º–æ–ª–æ–¥–æ–π/—Å—Ä–µ–¥–Ω–∏–π/—Å—Ç–∞—Ä—à–∏–π)
        - –¢–æ–Ω (—Å–µ—Ä—å—ë–∑–Ω—ã–π/casual/–¥—Ä–∞–º–∞—Ç–∏—á–Ω—ã–π)
        - –°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—á–∏
        - –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
        """
        prompt = f"""–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å—Ç–∏–ª—å –æ–∑–≤—É—á–∫–∏ YouTube –∫–∞–Ω–∞–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.

–ö–ê–ù–ê–õ: {channel_name}

–ó–ê–ì–û–õ–û–í–ö–ò –í–ò–î–ï–û:
{chr(10).join(f'- {t}' for t in video_titles[:15])}

–û–ü–ò–°–ê–ù–ò–Ø:
{chr(10).join(f'---{chr(10)}{d[:300]}' for d in descriptions[:5])}

–ù–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–º–∞—Ç–∏–∫–∏ –∏ —Å—Ç–∏–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª–∏, –∫–∞–∫–æ–π –≥–æ–ª–æ—Å —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

1. –ü–æ–ª –¥–∏–∫—Ç–æ—Ä–∞ (male/female) ‚Äî –∏—Å—Ö–æ–¥—è –∏–∑ —Ç–µ–º–∞—Ç–∏–∫–∏
2. –í–æ–∑—Ä–∞—Å—Ç –≥–æ–ª–æ—Å–∞ (young/middle/old) ‚Äî –º–æ–ª–æ–¥–æ–π —ç–Ω–µ—Ä–≥–∏—á–Ω—ã–π, —Å—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, —Å—Ç–∞—Ä—à–∏–π –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π
3. –¢–æ–Ω (serious/casual/dramatic) ‚Äî —Å–µ—Ä—å—ë–∑–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π, –ª—ë–≥–∫–∏–π —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π, –¥—Ä–∞–º–∞—Ç–∏—á–Ω—ã–π –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω—ã–π
4. –°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—á–∏ (slow/medium/fast) ‚Äî –º–µ–¥–ª–µ–Ω–Ω–∞—è –≤–¥—É–º—á–∏–≤–∞—è, —Å—Ä–µ–¥–Ω—è—è, –±—ã—Å—Ç—Ä–∞—è —ç–Ω–µ—Ä–≥–∏—á–Ω–∞—è
5. –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (calm/energetic/dramatic) ‚Äî —Å–ø–æ–∫–æ–π–Ω–∞—è, —ç–Ω–µ—Ä–≥–∏—á–Ω–∞—è, –¥—Ä–∞–º–∞—Ç–∏—á–Ω–∞—è

–û—Ç–≤–µ—Ç—å –≤ JSON:
{{
    "gender": "male",
    "age": "middle",
    "tone": "serious",
    "speed": "medium",
    "emotion": "dramatic",
    "reasoning": "–ø–æ—á–µ–º—É —Ç–∞–∫–æ–π –≤—ã–±–æ—Ä",
    "voice_description": "–æ–ø–∏—Å–∞–Ω–∏–µ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –≥–æ–ª–æ—Å–∞ –¥–ª—è —ç—Ç–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞"
}}"""

        response = self._chat([
            {"role": "system", "content": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –≥–æ–ª–æ—Å–æ–≤–æ–º—É –±—Ä–µ–Ω–¥–∏–Ω–≥—É –∏ –æ–∑–≤—É—á–∫–µ. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å –∫–æ–Ω—Ç–µ–Ω—Ç –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—à—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≥–æ–ª–æ—Å."},
            {"role": "user", "content": prompt}
        ])
        
        try:
            json_match = response[response.find('{'):response.rfind('}')+1]
            return json.loads(json_match)
        except:
            # –î–µ—Ñ–æ–ª—Ç –¥–ª—è –≤–æ–µ–Ω–Ω–æ–π —Ç–µ–º–∞—Ç–∏–∫–∏
            return {
                "gender": "male",
                "age": "middle", 
                "tone": "serious",
                "speed": "medium",
                "emotion": "dramatic",
                "reasoning": "–í–æ–µ–Ω–Ω–∞—è/–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è —Ç–µ–º–∞—Ç–∏–∫–∞ —Ç—Ä–µ–±—É–µ—Ç —Å–µ—Ä—å—ë–∑–Ω–æ–≥–æ –º—É–∂—Å–∫–æ–≥–æ –≥–æ–ª–æ—Å–∞"
            }
    
    def analyze_hooks(self, video_titles: List[str], video_descriptions: List[str]) -> Dict[str, Any]:
        """
        –ê–Ω–∞–ª–∏–∑ –∫—Ä—é—á–∫–æ–≤ (hooks) –∏–∑ —Ç–æ–ø–æ–≤—ã—Ö –≤–∏–¥–µ–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞
        
        –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–µ—Ä–≤—ã–µ 30 —Å–µ–∫—É–Ω–¥ –≤–∏–¥–µ–æ (–ø–æ –æ–ø–∏—Å–∞–Ω–∏—è–º –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º)
        –∏ —Å–æ–∑–¥–∞—ë—Ç –º–æ—â–Ω—ã–π hook –¥–ª—è –Ω–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ.
        
        –ü—Ä–∞–≤–∏–ª–∞ —Ö–æ—Ä–æ—à–µ–≥–æ hook:
        - –ù–∏–∫–∞–∫–∏—Ö –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π –∏ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–π
        - –°—Ä–∞–∑—É –∏–Ω—Ç—Ä–∏–≥–∞, —Ñ–∞–∫—Ç –∏–ª–∏ –≤–æ–ø—Ä–æ—Å
        - –í—ã–∑—ã–≤–∞–µ—Ç —ç–º–æ—Ü–∏—é (—Å—Ç—Ä–∞—Ö, –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ, —É–¥–∏–≤–ª–µ–Ω–∏–µ)
        - –ó–∞—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è –∏ —Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–ª—å—à–µ
        """
        prompt = f"""–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–ø–æ–≤—ã—Ö –≤–∏–¥–µ–æ –∏ –≤—ã—è–≤–∏ –ü–ê–¢–¢–ï–†–ù–´ –ö–†–Æ–ß–ö–û–í (hooks).

–ó–ê–ì–û–õ–û–í–ö–ò:
{chr(10).join(f'- {t}' for t in video_titles[:15])}

–û–ü–ò–°–ê–ù–ò–Ø (–Ω–∞—á–∞–ª–æ):
{chr(10).join(f'---{chr(10)}{d[:300]}' for d in video_descriptions[:10])}

=== –ó–ê–î–ê–ß–ê ===

1. –í—ã—è–≤–∏ –∫–∞–∫–∏–µ –¢–ò–ü–´ –ö–†–Æ–ß–ö–û–í –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:
   - –®–æ–∫–∏—Ä—É—é—â–∏–π —Ñ–∞–∫—Ç
   - –†–∏—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å
   - –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ/–ø–∞—Ä–∞–¥–æ–∫—Å
   - –õ–∏—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è
   - –û–±–µ—â–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞
   - –°—Ä–æ—á–Ω–æ—Å—Ç—å/—ç–∫—Å–∫–ª—é–∑–∏–≤

2. –°–æ–∑–¥–∞–π 5 –®–ê–ë–õ–û–ù–û–í –º–æ—â–Ω—ã—Ö –∫—Ä—é—á–∫–æ–≤ –¥–ª—è —ç—Ç–æ–π –Ω–∏—à–∏

3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ –¥–∞–π –ø—Ä–∏–º–µ—Ä

–í–ê–ñ–ù–û: –ö—Ä—é—á–æ–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ë–ï–ó –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π, —Å—Ä–∞–∑—É –≤ —Ç–µ–º—É!

–û—Ç–≤–µ—Ç—å –≤ JSON:
{{
    "hook_types_used": ["—Ç–∏–ø1", "—Ç–∏–ø2"],
    "analysis": "—á—Ç–æ –¥–µ–ª–∞–µ—Ç –∫—Ä—é—á–∫–∏ —ç—Ç–æ–≥–æ –∫–∞–Ω–∞–ª–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º–∏",
    "templates": [
        {{
            "type": "—Ç–∏–ø –∫—Ä—é—á–∫–∞",
            "template": "—à–∞–±–ª–æ–Ω —Å [–ü–ï–†–ï–ú–ï–ù–ù–´–ú–ò]",
            "example": "–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä",
            "why_works": "–ø–æ—á–µ–º—É —Ä–∞–±–æ—Ç–∞–µ—Ç"
        }}
    ],
    "best_practices": ["–ø—Ä–∞–∫—Ç–∏–∫–∞ 1", "–ø—Ä–∞–∫—Ç–∏–∫–∞ 2"],
    "avoid": ["—á–µ–≥–æ –∏–∑–±–µ–≥–∞—Ç—å"]
}}"""

        response = self._chat([
            {"role": "system", "content": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ YouTube retention –∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ –≤–Ω–∏–º–∞–Ω–∏—è. –°–æ–∑–¥–∞—ë—à—å –∫—Ä—é—á–∫–∏ —Å 80%+ —É–¥–µ—Ä–∂–∞–Ω–∏–µ–º –ø–µ—Ä–≤—ã—Ö 30 —Å–µ–∫—É–Ω–¥."},
            {"role": "user", "content": prompt}
        ])
        
        try:
            json_match = response[response.find('{'):response.rfind('}')+1]
            return json.loads(json_match)
        except:
            return {"raw_analysis": response}
    
    def generate_hook(self, topic: str, hook_templates: List[Dict], style: str) -> str:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ—â–Ω–æ–≥–æ –∫—Ä—é—á–∫–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–µ–º—ã
        
        Args:
            topic: –¢–µ–º–∞ –≤–∏–¥–µ–æ
            hook_templates: –®–∞–±–ª–æ–Ω—ã –∫—Ä—é—á–∫–æ–≤ –∏–∑ analyze_hooks()
            style: –°—Ç–∏–ª—å –∫–∞–Ω–∞–ª–∞
        
        Returns:
            –ì–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –∫—Ä—é—á–∫–∞ (–ø–µ—Ä–≤—ã–µ 30-45 —Å–µ–∫—É–Ω–¥ –≤–∏–¥–µ–æ)
        """
        templates_str = ""
        for t in hook_templates[:3]:
            templates_str += f"- {t.get('type', '')}: {t.get('template', '')}\n"
        
        prompt = f"""–°–æ–∑–¥–∞–π –ú–û–©–ù–´–ô –∫—Ä—é—á–æ–∫ –¥–ª—è YouTube –≤–∏–¥–µ–æ.

–¢–ï–ú–ê: {topic}
–°–¢–ò–õ–¨: {style}

–®–ê–ë–õ–û–ù–´ –ö–†–Æ–ß–ö–û–í (–∏—Å–ø–æ–ª—å–∑—É–π –∫–∞–∫ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ):
{templates_str}

=== –¢–†–ï–ë–û–í–ê–ù–ò–Ø ===

1. –ù–ò–ö–ê–ö–ò–• –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π ("–ü—Ä–∏–≤–µ—Ç", "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å", "–í —ç—Ç–æ–º –≤–∏–¥–µ–æ")
2. –°—Ä–∞–∑—É –ò–ù–¢–†–ò–ì–ê –∏–ª–∏ –®–û–ö–ò–†–£–Æ–©–ò–ô –§–ê–ö–¢
3. –î–ª–∏–Ω–∞: 3-5 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π (30-45 —Å–µ–∫—É–Ω–¥ –æ–∑–≤—É—á–∫–∏)
4. –î–æ–ª–∂–µ–Ω –≤—ã–∑–≤–∞—Ç—å –≠–ú–û–¶–ò–Æ (—Å—Ç—Ä–∞—Ö, –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ, —É–¥–∏–≤–ª–µ–Ω–∏–µ)
5. –ó–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –∏–Ω—Ç—Ä–∏–≥–æ–π —á—Ç–æ –±—É–¥–µ—Ç –¥–∞–ª—å—à–µ

–ù–ê–ü–ò–®–ò –¢–û–õ–¨–ö–û –¢–ï–ö–°–¢ –ö–†–Æ–ß–ö–ê, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π."""

        response = self._chat([
            {"role": "system", "content": f"–¢—ã —Å—Ü–µ–Ω–∞—Ä–∏—Å—Ç YouTube —Å retention 80%+. –°—Ç–∏–ª—å: {style}. –ü–∏—à–µ—à—å –∫—Ä—é—á–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å."},
            {"role": "user", "content": prompt}
        ], temperature=0.8, max_tokens=500)
        
        return response.strip()
    
    def generate_viral_thumbnail_concepts(self, topic: str, title: str, 
                                           script_summary: str, style: str) -> Dict[str, Any]:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 3 –í–ò–†–£–°–ù–´–• –∫–æ–Ω—Ü–µ–ø—Ü–∏–π –¥–ª—è YouTube –ø—Ä–µ–≤—å—é
        
        –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–º—É –∏ —Å–æ–∑–¥–∞—ë—Ç 3 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ —Å —Ä–∞–∑–Ω—ã–º–∏
        –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ CTR.
        
        Returns:
            {
                "analysis": "–∞–Ω–∞–ª–∏–∑ —Ç–µ–º—ã",
                "concepts": [
                    {
                        "type": "—Ç–∏–ø –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏",
                        "prompt_en": "–¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º",
                        "why_viral": "–ø–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–∏–≤–ª–µ—á—ë—Ç –≤–Ω–∏–º–∞–Ω–∏–µ",
                        "psychological_trigger": "–∫–∞–∫–æ–π —Ç—Ä–∏–≥–≥–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è"
                    }
                ]
            }
        """
        prompt = f"""–°–æ–∑–¥–∞–π 3 –í–ò–†–£–°–ù–´–• –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –¥–ª—è YouTube –ø—Ä–µ–≤—å—é.

–¢–ï–ú–ê –í–ò–î–ï–û: {topic}
–ó–ê–ì–û–õ–û–í–û–ö: {title}
–°–¢–ò–õ–¨ –ö–ê–ù–ê–õ–ê: {style}

–ö–†–ê–¢–ö–û–ï –°–û–î–ï–†–ñ–ê–ù–ò–ï:
{script_summary[:1500]}

=== –ó–ê–î–ê–ß–ê ===

–°–æ–∑–¥–∞–π 3 –†–ê–ó–ù–´–• –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –ø—Ä–µ–≤—å—é, –∫–∞–∂–¥–∞—è —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º —Ç—Ä–∏–≥–≥–µ—Ä–æ–º:

1. **–î–†–ê–ú–ê–¢–ò–ß–ù–ê–Ø** ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç —Å–∏–ª—å–Ω—ã–µ —ç–º–æ—Ü–∏–∏ (—Å—Ç—Ä–∞—Ö, —É–¥–∏–≤–ª–µ–Ω–∏–µ, –≤–æ—Å—Ö–∏—â–µ–Ω–∏–µ)
2. **–ò–ù–¢–†–ò–ì–£–Æ–©–ê–Ø** ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ, –∂–µ–ª–∞–Ω–∏–µ —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ
3. **–≠–ú–û–¶–ò–û–ù–ê–õ–¨–ù–ê–Ø** ‚Äî —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∞—è –∏—Å—Ç–æ—Ä–∏—è, –ª–∏—Ü–æ —Å —ç–º–æ—Ü–∏–µ–π

=== –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –ü–†–û–ú–ü–¢–ê–ú ===

–ö–∞–∂–¥—ã–π –ø—Ä–æ–º–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:
- –ù–∞ –ê–ù–ì–õ–ò–ô–°–ö–û–ú —è–∑—ã–∫–µ
- –î–ï–¢–ê–õ–¨–ù–´–ú (–º–∏–Ω–∏–º—É–º 50 —Å–ª–æ–≤)
- –û–ø–∏—Å—ã–≤–∞—Ç—å –ö–û–ù–ö–†–ï–¢–ù–£–Æ —Å—Ü–µ–Ω—É/–∫–æ–º–ø–æ–∑–∏—Ü–∏—é
- –í–∫–ª—é—á–∞—Ç—å: –æ—Å–≤–µ—â–µ–Ω–∏–µ, —Ü–≤–µ—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –¥–µ—Ç–∞–ª–∏
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è AI –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ (FLUX/Stable Diffusion)

=== –ü–°–ò–•–û–õ–û–ì–ò–ß–ï–°–ö–ò–ï –¢–†–ò–ì–ì–ï–†–´ –î–õ–Ø CTR ===

- –ö–æ–Ω—Ç—Ä–∞—Å—Ç (—Å–≤–µ—Ç/—Ç—å–º–∞, –¥–æ–±—Ä–æ/–∑–ª–æ)
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ª–∏—Ü–∞ (—É–¥–∏–≤–ª–µ–Ω–∏–µ, —Å—Ç—Ä–∞—Ö, —Ä–µ—à–∏–º–æ—Å—Ç—å)
- –ó–∞–≥–∞–¥–∫–∞ (—á—Ç–æ-—Ç–æ —Å–∫—Ä—ã—Ç–æ–µ, –Ω–µ–¥–æ—Å–∫–∞–∑–∞–Ω–Ω–æ–µ)
- –ú–∞—Å—à—Ç–∞–± (—ç–ø–∏—á–Ω–æ—Å—Ç—å, –≥—Ä–∞–Ω–¥–∏–æ–∑–Ω–æ—Å—Ç—å)
- –û–ø–∞—Å–Ω–æ—Å—Ç—å (—É–≥—Ä–æ–∑–∞, –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ)
- –ß–µ–ª–æ–≤–µ—á–Ω–æ—Å—Ç—å (–≥–ª–∞–∑–∞, —ç–º–æ—Ü–∏–∏, –∏—Å—Ç–æ—Ä–∏—è)

–û—Ç–≤–µ—Ç—å –≤ JSON:
{{
    "analysis": "–∫—Ä–∞—Ç–∫–∏–π –∞–Ω–∞–ª–∏–∑ —á—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —ç—Ç–æ–π —Ç–µ–º—ã",
    "target_emotion": "–∫–∞–∫—É—é —ç–º–æ—Ü–∏—é –¥–æ–ª–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–µ–≤—å—é",
    "concepts": [
        {{
            "type": "dramatic",
            "prompt_en": "detailed English prompt for AI image generation, describing exact scene, lighting, composition, mood, colors, style...",
            "why_viral": "–ø–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–∏–≤–ª–µ—á—ë—Ç –∫–ª–∏–∫–∏",
            "psychological_trigger": "–∫–∞–∫–æ–π —Ç—Ä–∏–≥–≥–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è",
            "composition": "–æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏"
        }},
        {{
            "type": "intriguing",
            "prompt_en": "...",
            "why_viral": "...",
            "psychological_trigger": "...",
            "composition": "..."
        }},
        {{
            "type": "emotional",
            "prompt_en": "...",
            "why_viral": "...",
            "psychological_trigger": "...",
            "composition": "..."
        }}
    ]
}}"""

        response = self._chat([
            {"role": "system", "content": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ YouTube –ø—Ä–µ–≤—å—é —Å CTR 20%+. –°–æ–∑–¥–∞—ë—à—å –ø—Ä–µ–≤—å—é –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –ù–ï–í–û–ó–ú–û–ñ–ù–û –Ω–µ –∫–ª–∏–∫–Ω—É—Ç—å. –ó–Ω–∞–µ—à—å –ø—Å–∏—Ö–æ–ª–æ–≥–∏—é –≤–Ω–∏–º–∞–Ω–∏—è –∏ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞. –ü–∏—à–µ—à—å –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è AI –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–º JSON."},
            {"role": "user", "content": prompt}
        ], temperature=0.8, max_tokens=3000)
        
        try:
            json_match = response[response.find('{'):response.rfind('}')+1]
            return json.loads(json_match)
        except:
            return {"concepts": [], "error": "Failed to parse response"}
    
    def analyze_competitor_thumbnail_style(self, channel_name: str, 
                                            video_titles: List[str]) -> Dict[str, Any]:
        """
        –ê–Ω–∞–ª–∏–∑ —Å—Ç–∏–ª—è –ø—Ä–µ–≤—å—é –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ—Ö–æ–∂–∏—Ö
        """
        prompt = f"""–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å—Ç–∏–ª—å –ø—Ä–µ–≤—å—é (thumbnails) YouTube –∫–∞–Ω–∞–ª–∞.

–ö–ê–ù–ê–õ: {channel_name}

–ó–ê–ì–û–õ–û–í–ö–ò –í–ò–î–ï–û:
{chr(10).join(f'- {t}' for t in video_titles[:15])}

–ù–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–º–∞—Ç–∏–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏ —Ç–∏–ø–∏—á–Ω—ã–π —Å—Ç–∏–ª—å –ø—Ä–µ–≤—å—é –¥–ª—è —Ç–∞–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:

1. –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ (–∫–∞–∫–∏–µ —Ü–≤–µ—Ç–∞ –¥–æ–º–∏–Ω–∏—Ä—É—é—Ç)
2. –ö–æ–º–ø–æ–∑–∏—Ü–∏—è (—á—Ç–æ –æ–±—ã—á–Ω–æ –≤ —Ü–µ–Ω—Ç—Ä–µ)
3. –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ (–¥—Ä–∞–º–∞—Ç–∏—á–Ω–æ–µ, —è—Ä–∫–æ–µ, –º—Ä–∞—á–Ω–æ–µ)
4. –¢–∏–ø–∏—á–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (–ª–∏—Ü–∞, –æ–±—ä–µ–∫—Ç—ã, —Ç–µ–∫—Å—Ç)
5. –°—Ç–∏–ª—å —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –ø—Ä–µ–≤—å—é

–û—Ç–≤–µ—Ç—å –≤ JSON:
{{
    "colors": "–æ–ø–∏—Å–∞–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º—ã",
    "composition": "–æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏",
    "mood": "–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",
    "typical_elements": ["—ç–ª–µ–º–µ–Ω—Ç1", "—ç–ª–µ–º–µ–Ω—Ç2"],
    "text_style": "—Å—Ç–∏–ª—å —Ç–µ–∫—Å—Ç–∞",
    "prompt_style": "—Å—Ç–∏–ª—å –¥–ª—è AI –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ (–Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º)",
    "recommendations": ["—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 1", "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 2"]
}}"""

        response = self._chat([
            {"role": "system", "content": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ YouTube –ø—Ä–µ–≤—å—é —Å CTR 15%+. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å —É—Å–ø–µ—à–Ω—ã–µ –∫–∞–Ω–∞–ª—ã."},
            {"role": "user", "content": prompt}
        ])
        
        try:
            json_match = response[response.find('{'):response.rfind('}')+1]
            return json.loads(json_match)
        except:
            return {
                "colors": "—Ç—ë–º–Ω—ã–µ —Å —è—Ä–∫–∏–º–∏ –∞–∫—Ü–µ–Ω—Ç–∞–º–∏",
                "composition": "—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç/–ª–∏—Ü–æ",
                "mood": "–¥—Ä–∞–º–∞—Ç–∏—á–Ω–æ–µ",
                "prompt_style": "dramatic, cinematic, high contrast, vibrant colors"
            }
